<div class="home-container">
  <!-- Feed Section -->
  <div class="feed-section">
    <!-- Create Post -->
    <div class="create-post-card">
      <textarea 
        [(ngModel)]="newPostContent"
        placeholder="Co s≈Çychaƒá?"
        class="post-input"
        rows="3"></textarea>
      <div class="post-actions-row">
        <input 
          type="text" 
          [(ngModel)]="newPostImageUrl"
          placeholder="URL obrazka (opcjonalnie)"
          class="image-url-input">
        <button 
          class="post-btn" 
          (click)="createPost()"
          [disabled]="isCreatingPost() || (!newPostContent.trim() && !newPostImageUrl.trim())">
          <span *ngIf="!isCreatingPost()">Opublikuj</span>
          <mat-spinner *ngIf="isCreatingPost()" diameter="20"></mat-spinner>
        </button>
      </div>
    </div>

    <!-- Loading Spinner -->
    <div class="loading-container" *ngIf="isLoading()">
      <mat-spinner diameter="40"></mat-spinner>
    </div>

    <!-- No Posts Message -->
    <div class="no-posts" *ngIf="!isLoading() && posts().length === 0">
      <p>Brak post√≥w do wy≈õwietlenia. Dodaj znajomych lub utw√≥rz pierwszy post!</p>
    </div>

    <!-- Posts and Ads -->
    <ng-container *ngFor="let item of getFeedWithAds()">
      <!-- Post Card -->
      <div class="post-card" *ngIf="item.type === 'post'">
        <div class="post-header">
          <div class="avatar" 
            [style.background-image]="'url(' + (item.post.authorAvatarUrl || getDefaultAvatar(item.post.authorUsername)) + ')'">
          </div>
          <div class="post-info">
            <span class="username">{{ item.post.authorUsername }}</span>
            <span class="date">{{ formatDate(item.post.createdAt) }}</span>
          </div>
        </div>
        
        <div class="post-image" *ngIf="item.post.imageUrl" [style.background-image]="'url(' + item.post.imageUrl + ')'"></div>
        
        <p class="post-text" *ngIf="item.post.content">{{ item.post.content }}</p>
        
        <div class="post-stats">
          <span>{{ item.post.likesCount }} polubie≈Ñ</span>
          <span>{{ item.post.commentsCount }} komentarzy</span>
        </div>
        
        <div class="post-actions">
          <button class="action-btn like-btn" (click)="likePost(item.post)" [class.liked]="item.post.likedByCurrentUser">
            <span class="action-icon">‚ù§</span>
            <span>{{ item.post.likedByCurrentUser ? 'Lubiƒô' : 'Polub' }}</span>
          </button>
          <button class="action-btn" (click)="toggleComments(item.post.id)">
            <span class="action-icon">üí¨</span>
            <span>Skomentuj</span>
          </button>
        </div>

        <!-- Comments Section -->
        <div class="comments-section" *ngIf="isCommentsExpanded(item.post.id)">
          <!-- Loading Comments -->
          <div class="loading-comments" *ngIf="isLoadingComments(item.post.id)">
            <mat-spinner diameter="24"></mat-spinner>
          </div>

          <!-- Comments List -->
          <div class="comments-list" *ngIf="!isLoadingComments(item.post.id)">
            <div class="comment-item" *ngFor="let comment of getComments(item.post.id)">
              <div class="comment-avatar" 
                [style.background-image]="'url(' + (comment.authorAvatarUrl || getDefaultAvatar(comment.authorUsername)) + ')'">
              </div>
              <div class="comment-content">
                <div class="comment-header">
                  <span class="comment-author">{{ comment.authorUsername }}</span>
                  <span class="comment-date">{{ formatDate(comment.createdAt) }}</span>
                </div>
                <p class="comment-text">{{ comment.content }}</p>
              </div>
            </div>

            <div class="no-comments" *ngIf="getComments(item.post.id).length === 0">
              <p>Brak komentarzy. BƒÖd≈∫ pierwszy!</p>
            </div>
          </div>

          <!-- Add Comment Form -->
          <div class="add-comment-form">
            <div class="comment-input-container">
              <input 
                type="text" 
                placeholder="Napisz komentarz..."
                class="comment-input"
                [value]="getCommentInput(item.post.id)"
                (input)="setCommentInput(item.post.id, $any($event.target).value)"
                (keydown.enter)="addComment(item.post.id)">
              <button 
                class="comment-submit-btn" 
                (click)="addComment(item.post.id)"
                [disabled]="isSubmittingCommentFor(item.post.id) || !getCommentInput(item.post.id).trim()">
                <mat-spinner *ngIf="isSubmittingCommentFor(item.post.id)" diameter="16"></mat-spinner>
                <mat-icon *ngIf="!isSubmittingCommentFor(item.post.id)">send</mat-icon>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Advertisement Card -->
      <div class="post-card ad-card-in-feed" *ngIf="item.type === 'ad'">
        <div class="ad-header">
          <span class="ad-label">Reklama</span>
        </div>
        <div class="ad-image" [style.background-image]="'url(' + item.ad.image + ')'"></div>
        <div class="ad-content">
          <h4 class="ad-title">{{ item.ad.title }}</h4>
          <p class="ad-description">{{ item.ad.description }}</p>
          <button class="ad-button">Dowiedz siƒô wiƒôcej</button>
        </div>
      </div>
    </ng-container>
  </div>
</div>
